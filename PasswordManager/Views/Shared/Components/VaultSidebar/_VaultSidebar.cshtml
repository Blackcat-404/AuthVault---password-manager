@using PasswordManager.ViewModels.Vault
@model VaultSidebarViewModel
@{
    var userName = Model.UserName;
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString() ?? "";
    var currentFolderId = ViewContext.RouteData.Values["folderId"]?.ToString();
    var itemCount = Model.CountAllItems;
    var colorMap = new Dictionary<string, string>
    {
        { "blue", "linear-gradient(135deg, #3498db 0%, #2980b9 100%)" },
        { "green", "linear-gradient(135deg, #27ae60 0%, #229954 100%)" },
        { "purple", "linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)" },
        { "orange", "linear-gradient(135deg, #f39c12 0%, #e67e22 100%)" },
        { "red", "linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)" },
        { "teal", "linear-gradient(135deg, #1abc9c 0%, #16a085 100%)" }
    };
}

<script>
    var sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    document.documentElement.style.setProperty('--sidebar-state', sidebarCollapsed ? 'collapsed' : 'expanded');
</script>

<style>
    :root[style*="--sidebar-state: expanded"] .sidebar-collapsed {
        display: none !important;
    }

    :root[style*="--sidebar-state: collapsed"] .sidebar-expanded {
        display: none !important;
    }
</style>

<!-- EXPANDED SIDEBAR -->
<aside class="sidebar sidebar-expanded" id="sidebar-expanded">
    <div class="sidebar-header">
        <div class="logo-section">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="32"
                     height="32"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                    <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
                </svg>
            </div>
            <span class="logo-text">AuthVault</span>
        </div>
        <button class="sidebar-toggle" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="24"
                 height="24"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class="toggle-icon">
                <rect width="18" height="18" x="3" y="3" rx="2" />
                <path d="M9 3v18" />
                <path d="m16 15-3-3 3-3" />
            </svg>
        </button>
    </div>

    <nav class="sidebar-nav">
        <!-- Vault Section -->
        <div class="nav-section">
            <div class="nav-section-title">Vault</div>
            <a href="@Url.Action("Home", "Vault")"
               class="nav-item @(currentAction == "Home" && string.IsNullOrEmpty(currentFolderId) ? "active" : "")">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4" />
                        <path d="m21 2-9.6 9.6" />
                        <circle cx="7.5" cy="15.5" r="5.5" />
                    </svg>
                </span>
                <span class="nav-item-text">All Items</span>
                <span class="nav-item-count">@itemCount</span>
            </a>
        </div>

        <!-- Folders Section (Scrollable) -->
        <div class="nav-section folders-section">
            <div class="nav-section-header">
                <div class="nav-section-title">Folders</div>
                <a href="@Url.Action("AddFolder", "Vault")"
                   class="add-folder-btn"
                   title="Add new folder">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14" />
                        <path d="M5 12h14" />
                    </svg>
                </a>
            </div>

            @if (Model.Folders.Any())
            {
                <div id="foldersScroll" class="folders-scrollable">
                    @foreach (var folder in Model.Folders)
                    {
                        var currentFolderIdStr = ViewContext.RouteData.Values["folderId"]
                        ?? Context.Request.Query["folderId"].FirstOrDefault();

                        var isActive = int.TryParse(currentFolderIdStr?.ToString(), out var folderId) && folderId == folder.Id;
                        var folderColor = colorMap.ContainsKey(folder.Color) ? colorMap[folder.Color] : colorMap["blue"];

                        <div class="folder-item-wrapper @(isActive ? "active" : "")">
                            <a href="@Url.Action("Folder", "Vault", new { folderId = folder.Id })"
                               class="nav-item folder-item @(isActive ? "active" : "")"
                               data-folder-name="@folder.Name"
                               data-folder-description="@folder.Description">
                                <span class="folder-color-indicator" style="background: @folderColor"></span>
                                <span class="nav-folder-icon" style="background: @folderColor">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="24"
                                         height="24"
                                         viewBox="0 0 24 24"
                                         fill="none"
                                         stroke="currentColor"
                                         stroke-width="2"
                                         stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" />
                                    </svg>
                                </span>
                                <span class="nav-item-text">@folder.Name</span>
                            </a>

                            @* Rich Tooltip *@
                            <div class="folder-tooltip">
                                <div class="folder-tooltip-header">
                                    <span class="folder-tooltip-icon" style="background: @folderColor">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" />
                                        </svg>
                                    </span>
                                    <strong class="folder-tooltip-name">@folder.Name</strong>
                                </div>
                                @if (!string.IsNullOrEmpty(folder.Description))
                                {
                                    <div class="folder-tooltip-description">
                                        @foreach (var line in folder.Description.Split("\n"))
                                        {
                                            @line
                            
                                            <br />
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="folder-tooltip-description">No Description</div>
                                }
                                <div class="folder-tooltip-meta">
                                    Created @folder.CreatedAt.ToString("MMM dd, yyyy")
                                </div>
                            </div>

                            <button class="folder-delete-btn"
                                    onclick="deleteFolder(event, @folder.Id, '@folder.Name')"
                                    title="Delete folder">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="16"
                                     height="16"
                                     viewBox="0 0 24 24"
                                     fill="none"
                                     stroke="currentColor"
                                     stroke-width="2"
                                     stroke-linecap="round"
                                     stroke-linejoin="round">
                                    <path d="M3 6h18" />
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                    <line x1="10" x2="10" y1="11" y2="17" />
                                    <line x1="14" x2="14" y1="11" y2="17" />
                                </svg>
                            </button>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Tools Section -->
        <div class="nav-section">
            <div class="nav-section-title">Tools</div>

            <!-- Password Generator -->
            <a href="#" class="nav-item" onclick="openGenerator(event)">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="m10.852 14.772-.383.923" />
                        <path d="M13.148 14.772a3 3 0 1 0-2.296-5.544l-.383-.923" />
                        <path d="m13.148 9.228.383-.923" />
                        <path d="m13.53 15.696-.382-.924a3 3 0 1 1-2.296-5.544" />
                        <path d="m14.772 10.852.923-.383" />
                        <path d="m14.772 13.148.923.383" />
                        <path d="M4.5 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-.5" />
                        <path d="M4.5 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-.5" />
                        <path d="M6 18h.01" />
                        <path d="M6 6h.01" />
                        <path d="m9.228 10.852-.923-.383" />
                        <path d="m9.228 13.148-.923.383" />
                    </svg>
                </span>
                <span class="nav-item-text">Password Generator</span>
            </a>

            <!-- Settings -->
            <a href="@Url.Action("GetSettings", "Settings")"
               class="nav-item @(currentAction == "Settings" ? "active" : "")">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </span>
                <span class="nav-item-text">Settings</span>
            </a>
        </div>
    </nav>

    <!-- Account Section -->
    <div class="account-section">
        <div class="account-item">
            <div class="account-avatar">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="24"
                     height="24"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                    <circle cx="12" cy="8" r="5" />
                    <path d="M20 21a8 8 0 0 0-16 0" />
                </svg>
            </div>
            <div class="account-info">
                <div class="account-name">@userName</div>
            </div>
        </div>
    </div>
</aside>

<!-- COLLAPSED SIDEBAR -->
<aside class="sidebar sidebar-collapsed collapsed" id="sidebar-collapsed">
    <div class="sidebar-header">
        <div class="logo-section">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="32"
                     height="32"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                    <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
                </svg>
            </div>
        </div>
        <button class="sidebar-toggle" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="24"
                 height="24"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class="toggle-icon">
                <rect width="18" height="18" x="3" y="3" rx="2" />
                <path d="M9 3v18" />
                <path d="m13 9 3 3-3 3" />
            </svg>
        </button>
    </div>

    <nav class="sidebar-nav">
        <!-- Vault Section -->
        <div class="nav-section">
            <a href="@Url.Action("Home", "Vault")"
               class="nav-item @(currentAction == "Home" && string.IsNullOrEmpty(currentFolderId) ? "active" : "")"
               title="All Items">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4" />
                        <path d="m21 2-9.6 9.6" />
                        <circle cx="7.5" cy="15.5" r="5.5" />
                    </svg>
                </span>
            </a>
        </div>

        <!-- Folders Section (Collapsed - only icons) -->
        <div class="nav-section folders-section">
            @if (Model.Folders.Any())
            {
                <div class="folders-scrollable">
                    @foreach (var folder in Model.Folders)
                    {
                        var currentFolderIdStr = ViewContext.RouteData.Values["folderId"]
                        ?? Context.Request.Query["folderId"].FirstOrDefault();

                        var isActive = int.TryParse(currentFolderIdStr?.ToString(), out var folderId) && folderId == folder.Id;
                        var folderColor = colorMap.ContainsKey(folder.Color) ? colorMap[folder.Color] : colorMap["blue"];

                        <div class="folder-item-wrapper @(isActive ? "active" : "")">
                            <a href="@Url.Action("Folder", "Vault", new { folderId = folder.Id })"
                               class="nav-item folder-item @(isActive ? "active" : "")"
                               title="@folder.Name">
                                <span class="nav-folder-icon" style="background: @folderColor">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="24"
                                         height="24"
                                         viewBox="0 0 24 24"
                                         fill="none"
                                         stroke="currentColor"
                                         stroke-width="2"
                                         stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" />
                                    </svg>
                                </span>
                            </a>

                            @* Rich Tooltip for collapsed state *@
                            <div class="folder-tooltip">
                                <div class="folder-tooltip-header">
                                    <span class="folder-tooltip-icon" style="background: @folderColor">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" />
                                        </svg>
                                    </span>
                                    <strong class="folder-tooltip-name">@folder.Name</strong>
                                </div>
                                @if (!string.IsNullOrEmpty(folder.Description))
                                {
                                    <div class="folder-tooltip-description">
                                        @foreach (var line in folder.Description.Split("\n"))
                                        {
                                            @line
                            
                                            <br />
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="folder-tooltip-description">No Description</div>
                                }
                                <div class="folder-tooltip-meta">
                                    Created @folder.CreatedAt.ToString("MMM dd, yyyy")
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Tools Section -->
        <div class="nav-section">
            <!-- Password Generator -->
            <a href="#" class="nav-item" onclick="openGenerator(event)" title="Password Generator">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="m10.852 14.772-.383.923" />
                        <path d="M13.148 14.772a3 3 0 1 0-2.296-5.544l-.383-.923" />
                        <path d="m13.148 9.228.383-.923" />
                        <path d="m13.53 15.696-.382-.924a3 3 0 1 1-2.296-5.544" />
                        <path d="m14.772 10.852.923-.383" />
                        <path d="m14.772 13.148.923.383" />
                        <path d="M4.5 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-.5" />
                        <path d="M4.5 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-.5" />
                        <path d="M6 18h.01" />
                        <path d="M6 6h.01" />
                        <path d="m9.228 10.852-.923-.383" />
                        <path d="m9.228 13.148-.923.383" />
                    </svg>
                </span>
            </a>

            <!-- Settings -->
            <a href="@Url.Action("GetSettings", "Settings")"
               class="nav-item @(currentAction == "Settings" ? "active" : "")"
               title="Settings">
                <span class="nav-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24"
                         height="24"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </span>
            </a>
        </div>
    </nav>

    <!-- Account Section -->
    <div class="account-section">
        <div class="account-item">
            <div class="account-avatar">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="24"
                     height="24"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                    <circle cx="12" cy="8" r="5" />
                    <path d="M20 21a8 8 0 0 0-16 0" />
                </svg>
            </div>
        </div>
    </div>
</aside>

@* Anti-forgery token for delete operations *@
@Html.AntiForgeryToken()

@section Scripts {
    <script>
        const scrollEl = document.getElementById('foldersScroll');
        const key = 'foldersScrollTop';

        if (scrollEl) {
            const saved = localStorage.getItem(key);
            if (saved !== null) {
                scrollEl.scrollTop = parseInt(saved, 10);
            }

            scrollEl.addEventListener('scroll', () => {
                localStorage.setItem(key, scrollEl.scrollTop);
            });
        }
    </script>
}
